# S3を理解する

## 課題１

### ストレージクラス

S3のデータ保管方法。クラスによって可用性、耐久性、課金体系が異なる。

- S3 Standard
  - 頻繁にアクセスされるデータ向け
  - コンテンツ配信、ビッグデータ分析など、幅広いユースケース

- S3 Standard-IA
    - 存続期間が長くあまり頻繁にアクセスされないデータ向け
    - データのバックアップ等

- S3 Intelligent-Tiering
  - アクセスパターンが変化、または不明な存続期間が長いデータ向け
  - アクセスパターンが予測できないコンテンツ配信など

- S3 One Zone-IA
    - 存続期間が長くあまり頻繁にアクセスされない、且つ重要度の低いデータ向け
    - サムネイル画像、データのセカンダリバックアップ等
- S3 Glacier
    - 取得時間が数分から数時間許容される長期アーカイブデータ向け
    - 長期アーカイブ(緊急性の高いアクセスあり)

- S3 Glacier Deep Archive
    - 取得時間が12時間許容される長期アーカイブデータ向け
    - 長期アーカイブ(緊急性の高いアクセスなし)


| ストレージクラス   | Standard  | Standard-IA | Intelligent-Tiering | One Zone-IA | Glacier   | Glacier Deep Archive |
| ---------- | --------- | ----------- | ------------------- | ----------- | --------- | -------------------- |
| 可用性        | 99.99%    | 99.9%       | 99.9%               | 99.5%       | 99.99%    | 99.99%               |
| 保存されるAZ    | **3AZ以上** | **3AZ以上**   | **3AZ以上**           | 1AZ         | **3AZ以上** | **3AZ以上**            |
| データ取り出し費用  | なし        | なし          | **あり**              | **あり**      | **あり**    | **あり**               |
| モニタリング費用   | なし        | なし          | **あり**              | なし          | なし        | なし                   |
| オートメーション費用 | なし        | なし          | **あり**              | なし          | なし        | なし                   |

---
- 参考
  - [6つのS3ストレージクラスの選択に迷った時みるチャートをつくってみた](https://dev.classmethod.jp/articles/should_i_choice_s3_storage_class/)
---

### ライフサイクル
オブジェクトに対して自動的に実行するアクションを設定できる。

ライフサイクルルールを作成すると、その設定は既存のオブジェクトにも適用される。

ライフサイクル設定の有効化、無効化はほぼリアルタイムで適用されるが、全体に適用されるまでに数分間程度の遅延が発生する場合がある。

ライフサイクルによるアクションは、大きく2つに分かれる

- 移行アクション
  - ストレージ料金が低くなる（その代わり取り出しの料金が高くなる）方向にのみ移行できる
- 失効アクション
  - バージョニングが有効なバケットであれば現行バージョンが削除される。

---

- 参考
  - [絵で見て 3分でおさらいする Amazon S3 のバージョニングとライフサイクル](https://dev.classmethod.jp/articles/3minutes-s3-versioning-lifecycle/)
---
#### 作成から30日後に安いストレージクラスに移動する

- 対象となるフォルダを作成する
![スクリーンショット 2021-08-22 15 34 43](https://user-images.githubusercontent.com/32977282/130345174-cc2f69e5-882b-49eb-b507-e04cf824e2fd.png)

- フォルダ内のデータにライフサイクルを設定する
![スクリーンショット 2021-08-22 15 33 21](https://user-images.githubusercontent.com/32977282/130345167-2e817288-8a48-4882-a32f-1d169abf503d.png)
![スクリーンショット 2021-08-22 15 33 40](https://user-images.githubusercontent.com/32977282/130345168-de74549d-b785-4b55-b76e-c2e9efdaf601.png)




#### 作成から90日経ったら自動的に削除する

- フォルダ内のデータにライフサイクルを設定する
![スクリーンショット 2021-08-22 15 35 57](https://user-images.githubusercontent.com/32977282/130345164-bc80198a-a914-4125-bbdb-ebc053df4934.png)

- フォルダ内のデータにライフサイクルを設定する
![スクリーンショット 2021-08-22 15 36 41](https://user-images.githubusercontent.com/32977282/130345165-230e2c90-40de-480a-b4bd-955567486270.png)
![スクリーンショット 2021-08-22 15 37 40](https://user-images.githubusercontent.com/32977282/130345173-5a8327c6-6199-4941-badc-c7b17a83885b.png)

## 課題２

### バージョニング
単一のオブジェクトの複数のバージョンを保持できる。操作ミスによる削除に対しても、簡単に復旧できる。

- バケットのバージョニングを有効化する
![スクリーンショット 2021-08-22 15 49 50](https://user-images.githubusercontent.com/32977282/130345563-4b2a32d8-900d-4510-9b50-db202f621f37.png)

- オブジェクトを削除すると現行バージョンが「削除マーカー」となる。
![スクリーンショット 2021-08-22 15 50 46](https://user-images.githubusercontent.com/32977282/130345566-90641eb5-e39d-49e2-9619-33e5a697ebba.png)

- 削除マーカーオブジェクトを削除すると復元できる。
![スクリーンショット 2021-08-22 15 51 56](https://user-images.githubusercontent.com/32977282/130345569-65cc631f-9c2e-45fc-abc1-a26f6c3dac21.png)

### レプリケーション
保存したオブジェクトのレプリカ(コピー)を作成できる。同一リージョン、クロスリージョン、クロスアカウントに対応している。

- 異なるリージョン(大阪)のバケットを作成する
![スクリーンショット 2021-08-22 15 57 26](https://user-images.githubusercontent.com/32977282/130345840-a56b9396-c99c-4138-9aea-d7354514f284.png)

- 東京リージョンのバケットにレプリケーションルールを設定する
![スクリーンショット 2021-08-22 15 58 13](https://user-images.githubusercontent.com/32977282/130345839-0b6b126d-9587-4e5c-8fd2-35e79664ea4b.png)
![スクリーンショット 2021-08-22 15 58 18](https://user-images.githubusercontent.com/32977282/130345835-5e782a66-a32b-4332-8507-1429512e7229.png)


- 東京リージョンのバケットに画像をアップロードする
![スクリーンショット 2021-08-22 16 03 35](https://user-images.githubusercontent.com/32977282/130345831-5435f13d-e422-4e5c-a61c-1d1bec9b4f3f.png)

- 大阪リージョンのバケットにも画像がレプリケートされる
![スクリーンショット 2021-08-22 16 03 24](https://user-images.githubusercontent.com/32977282/130345833-9c5f24fa-4696-4f8d-a0c0-f2993b5dc8b3.png)
